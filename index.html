<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Infographic: Gói Ưu Đãi Siêu Hấp Dẫn Dành Cho Người Trẻ Cùng Sacombank</title>
    
    <!-- NEW: Open Graph / Facebook Meta Tags -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://your-github-username.github.io/your-repo-name/">
    <meta property="og:title" content="Gói Ưu Đãi Mua Nhà Siêu Hấp Dẫn Dành Cho Người Trẻ | Sacombank">
    <meta property="og:description" content="Khám phá các gói vay ưu đãi Z HOME và PRIME HOME với lãi suất hấp dẫn, thủ tục đơn giản và công cụ tư vấn AI thông minh.">
    <meta property="og:image" content="https://images.pexels.com/photos/106399/pexels-photo-106399.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=2">

    <!-- NEW: Twitter Meta Tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://your-github-username.github.io/your-repo-name/">
    <meta name="twitter:title" content="Gói Ưu Đãi Mua Nhà Siêu Hấp Dẫn Dành Cho Người Trẻ | Sacombank">
    <meta name="twitter:description" content="Khám phá các gói vay ưu đãi Z HOME và PRIME HOME với lãi suất hấp dẫn, thủ tục đơn giản và công cụ tư vấn AI thông minh.">
    <meta name="twitter:image" content="https://images.pexels.com/photos/106399/pexels-photo-106399.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=2">

    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Be+Vietnam+Pro:wght@400;500;600;700;900&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

    <style>
        body {
            font-family: 'Be Vietnam Pro', sans-serif;
            background-color: #f0f4f8;
        }
        .main-title {
            font-weight: 900;
            background: linear-gradient(90deg, #00447c, #0072ce);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .card {
            border-radius: 1.5rem;
            box-shadow: 0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            border: 1px solid #e2e8f0;
            position: relative;
            overflow: hidden;
        }
        /* Styling for the background image */
        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-size: cover;
            background-position: center;
            z-index: 0;
            opacity: 0.7; /* Increased opacity for a very clear image */
            transition: opacity 0.4s ease, transform 0.4s ease;
        }
        .card:hover::before {
            opacity: 0.85; /* Image becomes even more visible on hover */
            transform: scale(1.05);
        }
        /* Content is placed on top of the background */
        .card-content {
            position: relative;
            z-index: 1;
            /* Gradient is now more transparent at the top */
            background: linear-gradient(to top, rgba(255, 255, 255, 0.95) 30%, rgba(255, 255, 255, 0.7) 65%, rgba(255, 255, 255, 0.4) 100%);
            height: 100%;
        }
        .card.z-home::before {
            /* New image for Z Home */
            background-image: url('https://images.pexels.com/photos/2089698/pexels-photo-2089698.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=1');
        }
        .card.prime-home::before {
            /* New, more luxurious image for Prime Home */
            background-image: url('https://images.pexels.com/photos/6585756/pexels-photo-6585756.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=1');
        }
        .card:hover {
            transform: translateY(-10px);
            box-shadow: 0 25px 50px -12px rgb(0 0 0 / 0.25);
        }
        .card-header {
            border-bottom: 1px solid rgba(226, 232, 240, 0.8);
            padding: 1.5rem;
        }
        .card-title {
            font-weight: 700;
            font-size: 1.75rem;
        }
        .card-subtitle {
            font-size: 1rem;
            color: #475569;
        }
        .feature-item {
            display: flex;
            align-items: flex-start;
            gap: 1rem;
            padding: 1rem 0;
        }
        .feature-icon {
            flex-shrink: 0;
            width: 2.5rem;
            height: 2.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }
        .z-home .feature-icon { background-color: #e0f2fe; color: #0284c7; }
        .prime-home .feature-icon { background-color: #dcfce7; color: #16a34a; }
        .icon-svg {
            width: 1.5rem;
            height: 1.5rem;
        }
        .interest-rate-table td {
            padding: 0.75rem;
            text-align: center;
            border: 1px solid rgba(226, 232, 240, 0.8);
        }
        .interest-rate-table thead td {
            background-color: rgba(248, 250, 252, 0.7);
            font-weight: 600;
        }
        .section-title {
            font-size: 2rem;
            font-weight: 700;
            color: #1e293b;
            text-align: center;
            margin-bottom: 2rem;
        }
        .footer {
            background-color: #00447c;
            color: white;
        }
        #ai-advisor-section {
            background: linear-gradient(135deg, #00529b, #0072ce);
        }
        #ai-result h2, #financial-check-result h2 { font-size: 1.25rem; color: #00447c; font-weight: 600; margin-top: 1rem; margin-bottom: 0.5rem;}
        #ai-result h3, #financial-check-result h3 { font-size: 1.1rem; color: #1e3a8a; font-weight: 600; margin-top: 1rem; margin-bottom: 0.5rem;}
        #ai-result p, #financial-check-result p { margin-bottom: 0.5rem; }
        #ai-result ul, #financial-check-result ul { list-style-position: inside; margin-left: 1rem; margin-bottom: 1rem; }
        #ai-result li, #financial-check-result li { margin-bottom: 0.25rem; }
        #ai-result table { width: 100%; border-collapse: collapse; margin-top: 1rem; }
        #ai-result th, #ai-result td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        #ai-result th { background-color: #f2f2f2; }
        #ai-result strong { color: #00529b; }
        .modal-overlay {
            position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0, 0, 0, 0.5); display: flex; align-items: center; justify-content: center; z-index: 1000;
        }
        .modal-content {
            background: white; padding: 2rem; border-radius: 1rem; text-align: center;
        }
        .loader {
            border: 4px solid #f3f3f3; border-top: 4px solid #0072ce; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; margin: 0 auto 1rem;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .hidden-iframe { display: none; }
    </style>
</head>
<body>
    <iframe name="hidden_iframe" id="hidden_iframe" class="hidden-iframe"></iframe>
    <div class="container mx-auto p-4 md:p-8">
        <!-- Header -->
        <header class="text-center mb-12">
            <img src="https://www.sacombank.com.vn/content/dam/sacombank/images/logo-sacombank.svg" alt="Logo Sacombank" class="mx-auto h-20 mb-4"
            onerror="this.onerror=null; this.src='https://placehold.co/300x80/00447c/ffffff?text=Sacombank';">
            <h1 class="text-3xl md:text-4xl main-title">GÓI ƯU ĐÃI SIÊU HẤP DẪN DÀNH CHO NGƯỜI TRẺ</h1>
            <p class="text-md text-slate-500 mt-2">Hiệu lực: Đến 30/09/2025</p>
        </header>

        <!-- Programs Comparison -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 md:gap-12 mb-12">
            <!-- Program 1: Z HOME -->
            <div class="card z-home">
                <div class="card-content">
                    <div class="card-header text-center">
                        <h2 class="card-title text-sky-600">Z HOME</h2>
                        <p class="card-subtitle">NHÀ CHẤT, TRẢ CHILL</p>
                    </div>
                    <div class="p-6 md:p-8">
                        <div class="feature-item"><div class="feature-icon"><i data-lucide="users" class="icon-svg"></i></div><div><h3 class="font-semibold text-lg">Đối tượng mục tiêu</h3><p class="text-slate-600">Khách hàng trẻ hoặc mua nhà lần đầu (18 - 40 tuổi).</p></div></div>
                        <div class="feature-item"><div class="feature-icon"><i data-lucide="banknote" class="icon-svg"></i></div><div><h3 class="font-semibold text-lg">Mức vay tối đa</h3><p class="text-slate-600 font-bold text-xl">10 Tỷ Đồng</p></div></div>
                        <div class="feature-item"><div class="feature-icon"><i data-lucide="calendar-clock" class="icon-svg"></i></div><div><h3 class="font-semibold text-lg">Thời hạn vay & Ân hạn</h3><p class="text-slate-600">Vay tối đa <span class="font-bold">40 năm</span>.</p><p class="text-slate-600">Ân hạn gốc tối đa <span class="font-bold">5 năm</span>.</p></div></div>
                        <div class="feature-item"><div class="feature-icon"><i data-lucide="receipt" class="icon-svg"></i></div><div><h3 class="font-semibold text-lg">Phí trả trước hạn</h3><p class="text-slate-600"><span class="font-bold">3%</span> trong thời gian ân hạn. Sau đó <span class="font-bold text-green-600">miễn phí</span>.</p></div></div>
                        <div class="mt-4">
                            <h3 class="font-semibold text-lg text-center mb-4">Lãi suất ưu đãi</h3>
                            <table class="w-full interest-rate-table">
                                <thead><tr><td>Kỳ hạn cố định</td><td>Lãi suất</td></tr></thead>
                                <tbody>
                                    <tr><td>12 Tháng</td><td class="font-bold text-sky-700 text-lg">6.50%/năm</td></tr>
                                    <tr><td>24 Tháng</td><td class="font-bold text-sky-700 text-lg">7.00%/năm</td></tr>
                                    <tr><td>36 Tháng</td><td class="font-bold text-sky-700 text-lg">7.50%/năm</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Program 2: PRIME HOME -->
            <div class="card prime-home">
                <div class="card-content">
                    <div class="card-header text-center">
                        <h2 class="card-title text-green-600">PRIME HOME</h2>
                        <p class="card-subtitle">AN CƯ ĐẲNG CẤP</p>
                    </div>
                    <div class="p-6 md:p-8">
                        <div class="feature-item"><div class="feature-icon"><i data-lucide="gem" class="icon-svg"></i></div><div><h3 class="font-semibold text-lg">Đối tượng mục tiêu</h3><p class="text-slate-600">Khách hàng có nhu cầu vay mua BĐS thứ 2 trở lên.</p></div></div>
                        <div class="feature-item"><div class="feature-icon"><i data-lucide="infinity" class="icon-svg"></i></div><div><h3 class="font-semibold text-lg">Mức vay tối đa</h3><p class="text-slate-600 font-bold text-xl">Không giới hạn</p></div></div>
                        <div class="feature-item"><div class="feature-icon"><i data-lucide="calendar-clock" class="icon-svg"></i></div><div><h3 class="font-semibold text-lg">Thời hạn vay & Ân hạn</h3><p class="text-slate-600">Vay tối đa <span class="font-bold">40 năm</span>.</p><p class="text-slate-600">Ân hạn gốc tối đa <span class="font-bold">5 năm</span>.</p></div></div>
                        <div class="feature-item"><div class="feature-icon"><i data-lucide="receipt" class="icon-svg"></i></div><div><h3 class="font-semibold text-lg">Phí trả trước hạn</h3><p class="text-slate-600"><span class="font-bold">1%</span> trong thời gian ân hạn. Sau đó <span class="font-bold text-green-600">miễn phí</span>.</p></div></div>
                        <div class="mt-4">
                            <h3 class="font-semibold text-lg text-center mb-4">Lãi suất ưu đãi</h3>
                            <table class="w-full interest-rate-table">
                                <thead><tr><td>Kỳ hạn cố định</td><td>Lãi suất</td></tr></thead>
                                <tbody>
                                    <tr><td>12 Tháng</td><td class="font-bold text-green-700 text-lg">8.00%/năm</td></tr>
                                    <tr><td>24 Tháng</td><td class="font-bold text-green-700 text-lg">8.50%/năm</td></tr>
                                    <tr><td>36 Tháng</td><td class="font-bold text-green-700 text-lg">9.00%/năm</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Gemini AI Advisor Section -->
        <div id="ai-advisor-section" class="rounded-2xl p-8 md:p-10 shadow-lg text-white mt-12">
            <h2 class="text-3xl font-bold text-center mb-2">Công cụ Tư vấn & Ước tính</h2>
            <p class="text-center text-lg opacity-90 mb-8">Nhận đề xuất gói vay và ước tính trả nợ với sự trợ giúp của AI</p>
            <div class="max-w-4xl mx-auto bg-white/10 p-6 rounded-xl">
                <div class="grid md:grid-cols-2 gap-6">
                    <div><label for="age" class="font-semibold mb-2 block">Tuổi của bạn</label><input type="number" id="age" placeholder="Ví dụ: 30" class="w-full p-3 rounded-lg border-2 border-transparent focus:border-sky-300 focus:ring-sky-300 text-slate-800"></div>
                    <div><label for="income" class="font-semibold mb-2 block">Thu nhập hàng tháng (VND)</label><input type="text" inputmode="numeric" id="income" placeholder="Ví dụ: 25.000.000" class="w-full p-3 rounded-lg border-2 border-transparent focus:border-sky-300 focus:ring-sky-300 text-slate-800"></div>
                    <div><label for="loanAmount" class="font-semibold mb-2 block">Số tiền muốn vay (VND)</label><input type="text" inputmode="numeric" id="loanAmount" placeholder="Ví dụ: 2.000.000.000" class="w-full p-3 rounded-lg border-2 border-transparent focus:border-sky-300 focus:ring-sky-300 text-slate-800"></div>
                    <div><label for="loanTerm" class="font-semibold mb-2 block">Thời hạn vay (năm)</label><input type="number" id="loanTerm" placeholder="Ví dụ: 20" max="40" class="w-full p-3 rounded-lg border-2 border-transparent focus:border-sky-300 focus:ring-sky-300 text-slate-800"></div>
                </div>
                <button id="get-advice-btn" class="mt-6 w-full bg-white text-sky-600 font-bold py-4 px-6 rounded-lg text-lg hover:bg-sky-100 transition-all duration-300 flex items-center justify-center gap-2"><i data-lucide="sparkles" class="w-5 h-5"></i>Nhận tư vấn & Ước tính</button>
            </div>
        </div>

        <!-- AI Result Display -->
        <div id="ai-result-container" class="hidden mt-8 bg-white rounded-2xl p-8 md:p-10 shadow-lg border border-slate-200">
             <h2 class="section-title !text-2xl !mb-6">Kết quả tư vấn từ AI</h2>
             <div id="ai-result" class="prose max-w-none"></div>
             <!-- NEW: Financial Health Check Section -->
             <div id="financial-health-check-section" class="hidden mt-6 pt-6 border-t border-slate-200">
                <button id="financial-check-btn" class="w-full bg-green-100 text-green-800 font-bold py-4 px-6 rounded-lg text-lg hover:bg-green-200 transition-all duration-300 flex items-center justify-center gap-2">
                    <i data-lucide="shield-check" class="w-5 h-5"></i>
                    Phân tích sâu hơn & nhận mẹo tiết kiệm
                </button>
                <div id="financial-check-result" class="prose max-w-none mt-4"></div>
             </div>
        </div>
        
        <!-- Registration Form Section -->
        <div id="registration-form-section" class="mt-12 bg-white rounded-2xl p-8 md:p-10 shadow-lg border border-slate-200">
            <h2 class="section-title">Đăng Ký Tư Vấn Ngay</h2>
            <p class="text-center text-slate-600 -mt-6 mb-8">Để lại thông tin để được chuyên viên của chúng tôi hỗ trợ nhanh nhất!</p>
            <form action="https://docs.google.com/forms/u/0/d/e/1FAIpQLSf9aXLbuJAkMm_HkZ1QPaZHgok6qtRJpWEiZdcefO2DMx_-LA/formResponse" method="POST" id="google-form" target="hidden_iframe">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                    <div><label for="name" class="font-medium text-slate-700 mb-2 block">Họ và tên</label><input type="text" id="name" name="entry.192648593" required class="w-full p-3 rounded-lg border border-slate-300 focus:border-sky-500 focus:ring-sky-500"></div>
                    <div><label for="phone" class="font-medium text-slate-700 mb-2 block">Số điện thoại</label><input type="tel" id="phone" name="entry.116094916" required class="w-full p-3 rounded-lg border border-slate-300 focus:border-sky-500 focus:ring-sky-500"></div>
                    <div><label for="cccd" class="font-medium text-slate-700 mb-2 block">Số CCCD (Không bắt buộc)</label><input type="text" id="cccd" name="entry.71296462" class="w-full p-3 rounded-lg border border-slate-300 focus:border-sky-500 focus:ring-sky-500"></div>
                    <div><label for="requested_loan" class="font-medium text-slate-700 mb-2 block">Số tiền đề xuất vay (VND)</label><input type="text" inputmode="numeric" id="requested_loan" name="entry.538905979" required class="w-full p-3 rounded-lg border border-slate-300 focus:border-sky-500 focus:ring-sky-500"></div>
                </div>
                <div class="mb-6"><label for="requested_term" class="font-medium text-slate-700 mb-2 block">Thời gian vay (năm)</label><input type="number" id="requested_term" name="entry.890766995" required max="40" class="w-full p-3 rounded-lg border border-slate-300 focus:border-sky-500 focus:ring-sky-500"></div>
                <button type="submit" id="submit-form-btn" class="w-full bg-sky-600 text-white font-bold py-4 px-6 rounded-lg text-lg hover:bg-sky-700 transition-all duration-300 flex items-center justify-center gap-2"><i data-lucide="send" class="w-5 h-5"></i>Gửi thông tin</button>
            </form>
        </div>


        <!-- General Conditions -->
        <div class="bg-white rounded-2xl p-8 md:p-10 shadow-lg border border-slate-200 mt-12">
            <h2 class="section-title">Điều Kiện & Lưu Ý Chung</h2>
            <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8 text-slate-700">
                <div class="flex items-start gap-4"><div class="bg-slate-100 p-3 rounded-full text-slate-600"><i data-lucide="check-circle-2" class="w-6 h-6"></i></div><div><h4 class="font-semibold">Mục đích vay</h4><p>Mua, xây, sửa nhà/đất; Tiêu dùng phục vụ đời sống (bao gồm hoàn vốn, tái tài trợ).</p></div></div>
                <div class="flex items-start gap-4"><div class="bg-slate-100 p-3 rounded-full text-slate-600"><i data-lucide="package-plus" class="w-6 h-6"></i></div><div><h4 class="font-semibold">Điều kiện tham gia</h4><p>Sử dụng tối thiểu 05 SPDV.</p></div></div>
                <div class="flex items-start gap-4"><div class="bg-slate-100 p-3 rounded-full text-slate-600"><i data-lucide="file-check" class="w-6 h-6"></i></div><div><h4 class="font-semibold">Loại khoản vay</h4><p>Khoản vay trung, dài hạn, giải ngân mới.</p></div></div>
                <div class="flex items-start gap-4"><div class="bg-slate-100 p-3 rounded-full text-slate-600"><i data-lucide="shield-off" class="w-6 h-6"></i></div><div><h4 class="font-semibold">Không áp dụng</h4><p>Vay bảo đảm bằng tiền gửi, vay tín chấp, vay mua ô tô.</p></div></div>
                <div class="flex items-start gap-4"><div class="bg-slate-100 p-3 rounded-full text-slate-600"><i data-lucide="wallet" class="w-6 h-6"></i></div><div><h4 class="font-semibold">Miễn phí trả nợ gốc</h4><p>Miễn phí phạt khi thanh toán thêm tối đa 100 triệu/kỳ để giảm dư nợ.</p></div></div>
                <div class="flex items-start gap-4"><div class="bg-slate-100 p-3 rounded-full text-slate-600"><i data-lucide="rocket" class="w-6 h-6"></i></div><div><h4 class="font-semibold">Lưu ý</h4><p>Thủ tục đơn giản - xét duyệt nhanh gọn.</p></div></div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer mt-12 p-8 text-center text-lg leading-relaxed">
        <p class="font-bold">Sacombank Hà Thành</p>
        <p>Số 25+27 Cửa Bắc, phường Trúc Bạch, quận Ba Đình, Hà Nội</p>
        <p class="mt-2">Thông tin liên hệ: <span class="font-semibold">Mr Duy CVKH - SĐT 0944 443 179</span></p>
    </footer>

    <!-- Modal for Loading/Error/Success -->
    <div id="modal" class="modal-overlay hidden">
        <div class="modal-content">
            <div id="modal-loader" class="hidden"><div class="loader"></div><p>AI đang phân tích... Vui lòng chờ trong giây lát.</p></div>
            <div id="modal-error" class="hidden"><p class="text-red-500 font-semibold">Đã xảy ra lỗi!</p><p id="error-message" class="mt-2"></p><button id="close-modal-btn" class="mt-4 bg-red-500 text-white px-4 py-2 rounded-lg">Đóng</button></div>
            <div id="modal-success" class="hidden"><p class="text-green-500 font-semibold">Gửi thông tin thành công!</p><p class="mt-2">Cảm ơn bạn đã đăng ký. Chúng tôi sẽ liên hệ lại sớm nhất có thể.</p><button id="close-success-modal-btn" class="mt-4 bg-green-500 text-white px-4 py-2 rounded-lg">Tuyệt vời!</button></div>
        </div>
    </div>

    <script>
        lucide.createIcons();

        // --- Number Input Formatting ---
        function formatNumber(input) {
            let rawValue = input.value.replace(/\D/g, '');
            if (rawValue) {
                const formattedValue = new Intl.NumberFormat('vi-VN').format(parseInt(rawValue, 10));
                input.value = formattedValue;
            } else {
                input.value = '';
            }
        }

        const inputsToFormat = ['income', 'loanAmount', 'requested_loan'];
        inputsToFormat.forEach(id => {
            const inputElement = document.getElementById(id);
            if (inputElement) {
                inputElement.addEventListener('input', () => formatNumber(inputElement));
            }
        });

        // --- Loan Term Input Validation ---
        const loanTermInputs = ['loanTerm', 'requested_term'];
        loanTermInputs.forEach(id => {
            const inputElement = document.getElementById(id);
            if (inputElement) {
                inputElement.addEventListener('input', () => {
                    if (parseInt(inputElement.value, 10) > 40) {
                        inputElement.value = '40';
                    }
                });
            }
        });


        // --- Gemini AI Integration ---
        const getAdviceBtn = document.getElementById('get-advice-btn');
        const aiResultContainer = document.getElementById('ai-result-container');
        const aiResultDiv = document.getElementById('ai-result');
        const modal = document.getElementById('modal');
        const modalLoader = document.getElementById('modal-loader');
        const modalError = document.getElementById('modal-error');
        const modalSuccess = document.getElementById('modal-success');
        const errorMessage = document.getElementById('error-message');
        const closeModalBtn = document.getElementById('close-modal-btn');
        const closeSuccessModalBtn = document.getElementById('close-success-modal-btn');
        // NEW: Elements for the new feature
        const financialHealthCheckSection = document.getElementById('financial-health-check-section');
        const financialCheckBtn = document.getElementById('financial-check-btn');
        const financialCheckResultDiv = document.getElementById('financial-check-result');

        // Store user data for the second API call
        let currentUserData = {};

        const showModal = (type, message = '') => {
            modal.classList.remove('hidden');
            modalLoader.classList.add('hidden');
            modalError.classList.add('hidden');
            modalSuccess.classList.add('hidden');

            if (type === 'loading') {
                modalLoader.classList.remove('hidden');
            } else if (type === 'error') {
                modalError.classList.remove('hidden');
                errorMessage.textContent = message;
            } else if (type === 'success') {
                modalSuccess.classList.remove('hidden');
            }
        };
        const hideModal = () => { modal.classList.add('hidden'); };
        closeModalBtn.addEventListener('click', hideModal);
        closeSuccessModalBtn.addEventListener('click', hideModal);

        getAdviceBtn.addEventListener('click', async () => {
            const age = document.getElementById('age').value;
            // Unformat the numbers before sending to the API
            const income = document.getElementById('income').value.replace(/\./g, '');
            const loanAmount = document.getElementById('loanAmount').value.replace(/\./g, '');
            const loanTerm = document.getElementById('loanTerm').value;

            if (!age || !income || !loanAmount || !loanTerm) {
                showModal('error', 'Vui lòng điền đầy đủ thông tin để nhận tư vấn.');
                return;
            }
            showModal('loading');

            // Store data for the next call
            currentUserData = {
                age: parseInt(age),
                income: parseInt(income),
                loanAmount: parseInt(loanAmount),
                loanTerm: parseInt(loanTerm),
                request_type: 'initial_advice' // Specify request type
            };

            const apiUrl = 'https://sacombank-ai-proxy.vercel.app/api/get-advice';
            
            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(currentUserData)
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error || `API call failed with status: ${response.status}`);
                }
                
                const result = await response.json();

                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    const text = result.candidates[0].content.parts[0].text;
                    aiResultDiv.innerHTML = marked.parse(text);
                    aiResultContainer.classList.remove('hidden');
                    financialHealthCheckSection.classList.remove('hidden'); // Show the new button
                    financialCheckResultDiv.innerHTML = ''; // Clear previous results
                    aiResultContainer.scrollIntoView({ behavior: 'smooth', block: 'start' });
                } else {
                   throw new Error('Không nhận được phản hồi hợp lệ từ AI.');
                }
            } catch (error) {
                console.error('Error calling proxy API:', error);
                showModal('error', `Đã có lỗi xảy ra khi kết nối với AI. Vui lòng thử lại sau. (Lỗi: ${error.message})`);
            } finally {
                hideModal();
            }
        });

        // NEW: Event listener for the financial health check button
        financialCheckBtn.addEventListener('click', async () => {
            financialCheckResultDiv.innerHTML = `<div class="flex justify-center items-center"><div class="loader"></div></div>`;
            
            const payload = {
                ...currentUserData,
                request_type: 'financial_check' // Specify the new request type
            };
            
            const apiUrl = 'https://sacombank-ai-proxy.vercel.app/api/get-advice';

            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error || `API call failed with status: ${response.status}`);
                }

                const result = await response.json();

                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    const text = result.candidates[0].content.parts[0].text;
                    financialCheckResultDiv.innerHTML = marked.parse(text);
                } else {
                    throw new Error('Không nhận được phản hồi hợp lệ từ AI.');
                }

            } catch (error) {
                 financialCheckResultDiv.innerHTML = `<p class="text-red-500">Đã có lỗi xảy ra: ${error.message}</p>`;
            }
        });

        // --- Google Form Submission ---
        const googleForm = document.getElementById('google-form');
        let formSubmitted = false;
        googleForm.addEventListener('submit', function(e) {
            if (!formSubmitted) {
                formSubmitted = true;
                setTimeout(() => {
                    showModal('success');
                    googleForm.reset();
                    formSubmitted = false; // Reset for next submission
                }, 1000);
            }
        });
    </script>
</body>
</html>
